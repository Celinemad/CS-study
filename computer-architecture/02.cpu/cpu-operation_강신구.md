# CPU와 작동 원리


## 1 ) ALU와 제어장치

1. ALU
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/ccd9570b-85c2-4c37-a7ea-3521eb1cd311/b76050cd-d034-401a-8161-a278b92685b8/Untitled.png)
    
    1. 특징
        1. 레지스터를 통해 피연산자를 받아들이고, 제어장치로부터 수행한 연산을 알려주는 제어 신호를 받아들이다.
        2. 레지스터와 제어장치로부터 받아들인 피연산자와 제어 신호로 산술 연산, 논리 연산 등 다양한 연산을 수행한다.
        3. 결과값은 메모리에 바로 저장되지 않고 레지스터에 저장된다.
            - CPU가 메모리에 접근하는 속도가 레지스터에 접근하는 속도보다 훨씬 느리기 때문이다.
    2. 플래그
        1. 부호 플래그
            - 연산한 결과의 부호를 나타낸다.
        2. 제로 플래그
            - 연산 결과가 0인지 아닌지의 여부를 나타낸다.
        3. 캐리 플래그
            - 연산 결과 올림수나 발림수가 발생했는지를 나타낸다.
        4. 오버플로우 플래그
            - 오버플로우가 발생했는지를 나타낸다.
        5. 인터럽트 플래그
            - 인터럽트가 가능한지를 나타낸다.
        6. 슈퍼바이저 플래그
            - 커널모드인지, 사용자모드인지 구분할 수 있다.
        7. 플래그들은 ‘플래그 레지스터’에 저장된다.
2. 제어장치
    1. 제어장치는 제어 신호를 내보내고, 명령어를 해석하는 부품
    2. 제어장비가 받아들이는 정보
        1. 클럭 신호를 받아들인다.
            - 시간단위로, 주기에 맞추어 특정한 일이 발생한다.
        2. 해석할 명령어를 받아들인다.
        3. 플러그 레지스터 안의 플래그 값을 받아들이고 이에 대한 신호를 발생시킨다.
        4. 제어 버스로 전달된 제어 신호를 받아들인다.
    3. 제어장치가 내보내는 정보
        1. CPU 외부에 전달
            - 제어 버스를 통해 전달
            - 메모리에 전달하는 신호로서, 메모리에 저장된 값을 읽거나 메모리에 새로운 값을 쓰려고 할 때 보내는 신호
            - 입출력장치(보조기억장치 포함)에 전달하는 신호로서, 입출력장치의 값을 읽거나 입출력장치에 새로운 값을 쓰려고 할 때 보내는 신호
        2. CPU 내부에 전달
            - ALU에 전달하는 신호로서, 수행할 연산을 지시하는 신호
            - 레지스터에 전달하는 신호로서, 레지스터 간에 테이터를 이동시키거나 레지스터에 저장된 명령어를 해석하기 위해 전달하는 신호

## 2 ) 레지스터

1. 특징
    1. 프로그램 속의 명령어와 데이터를 프로그램 실행 전 / 후로 저장한다.
    2. 종류가 다양하고 각기 다른 역할을 수행한다.
2. 종류
    1. 프로그램 카운터(Program Counter, PC)
        1. 메모리에서 읽어들일 명령어의 주소를 저장한다.
        2. 어떤 CPU에서는 PC를 명령어 포인터(Instruction Pointer, IP)라고도 부른다.
    2. 명령어 레지스터(Instruction Register, IR)
        1. 메모리에서 읽어들인 명령어를 저장하는 레지스터
        2. 제어장치는 IR 안에 있는 명령어를 받아들이고 해석한 뒤 제어 신호를 보낸다.
    3. 메모리 주소 레지스터(Memory Address Register, MAR)
        1. 메모리의 주소를 저장하는 레지스터
        2. CPU가 읽어들이고자 하는 주소 값을 주소 버스로 보낼 때, 이곳을 거치게 된다.
    4. 메모리 버퍼 레지스터(Memory Buffer Register, MBR)
        1. 메모리와 주고받을 값(데이터, 명령어)을 저장하는 레지스터
        2. 메모리에 쓰고 싶은 값은 이곳을 거쳐 데이터 버스로 보내고, 메모리로부터 데이터 버스를 통해 값을 전달받을 때도 여기를 거친다.
    5. 범용 레지스터(General Purpose Register)
        1. 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터
        2. 데이터와 주소를 모두 저장할 수 있다.
            - MBR : 데이터 버스로 주고받을 값만 저장한다.
            - MAR : 주소 버스로 내보낼 주소값만 저장한다.
    6. 플래그 레지스터
        1. ALU 연산 결과에 따른 플래그를 저장하는 레지스터
        2. 연산 결과 또는 CPU 상태에 대한 부가적인 정보를 저장한다.
3. 특정 레지스터를 이용한 주소 지정 방식
    1. 스택 주소 지정 방식
        1. 스택 포인터를 이용한 주소 지정 방식
            - 스택은 메모리 안에 스택처럼 사용할 영역으로 지정된 스택 영역이라는 곳에 있다.
            - 다른 주소 공간과는 달리, 스택처럼만 사용하게 된다.
        2. 스택 포인터는 스택의 꼭대기를 가리키는 레지스터로, 스택에 마지막으로 저장한 값의 위치를 저장한다.
    2. 변위 주소 지정 방식(displacement addressing mode)
        1. 오퍼랜드 필드의 값(변위)과 특정 레지스터의 값을 더하여 유효 주소를 얻어내는 주소 지정 방식
        2. 이 주소 지정 방식을 사용하는 명령어는 세 가지 필드를 가진다.
            - 레지스터 필드 : 이 레지스터의 값과
            - 오퍼랜드 필드 : 이 주소를 더한 곳에 있는 데이터로
            - 연산 코드 필드 : 이런 내용을 수행하라는 것
        3. 상대 주소 지정 방식(Relative addressing mode)
            - 오퍼랜드와 프로그램 카운터의 값(=읽어들일 명령어의 주소)을 더하여 유효 주소를 얻는 방식
                - 오퍼랜드가 -3이었다면, CPU는 실행하려는 명령어의 세 번째 이전 번지로 접근한다.
                - 오퍼랜드가 3이었다면, CPU는 실행하련ㄴ 명령어의 세 번째 이후 번지로 접근한다.
        4. 베이스 레지스터 주소 지정 방식(Base-register addressing mode)
            - 오퍼랜드와 베이스 레지스터의 값을 더하여 유효 주소를 얻는 방식
            - 베이스 레지스터 속 기준 주소로부터 오퍼랜드만큼 떨어진 주소에 접근하여 유효 주소를 얻는 방식

## 3 ) 명령어 사이클과 인터럽트

1. 명령어 사이클(Instruction cycle)
    1. CPU가 하나의 명령어를 처리하는 정형화된 흐름을 의미한다.
    2. CPU는 명령어 사이클을 반복하며 명령어들을 처리해 나간다.
    3. 종류
        1. 인출 사이클(fetch cycle)
            - 명령어를 메모리에서 CPU로 가져오는 단계
        2. 실행 사이클(execution cycle)
            - CPU로 가져온 명령어를 실행하는 단계로서, 제어장치가 명령어 레지스터에 담긴 값을 해석하고, 제어 신호를 발생시키는 단계
        3. 간접 사이클(Indirect cycle)
            - 인출한 명령어를 실행하기 위해, 실행 단계 이전에 다시 한 번 메모리에 접근하는 단계
2. 인터럽트(Interrupt)
    1. CPU의 작업을 중간에 확인하는 신호
    2. 종류
        1. 동기 인터럽트(Synchronous interrupts)
            - CPU에 의해 발생하는 인터럽트로, 명령어들을 수행하는 도중 프로그래밍 오류와 같은 예상치 못한 상황에 마주쳤을 때 발생한다.
            - 예외(Exception)라고도 부른다.
        2. 비동기 인터럽트(asynhronous interrupts)
            - 입출력장치에 의해 발생하는 인터럽트로서, 입출력장치가 CPU에 보내는 알림을 의미한다.
            - 하드웨어 인터럽트(Hardware interrupt)라고도 부른다.
                - CPU는 입출력 작업 도중에도 효율적으로 명령어를 처리하기 위해 하드웨어 인터럽트를 사용한다.
    3. 인터럽트 처리 순서
        1. 입출력장치가 CPU에 인터럽트 요청 신호를 보낸다.
        2. CPU는 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인한다.
        3. CPU는 인터럽트 요청을 확인하고 인터럽트 플래그를 통해 현재 인터럽트를 받아들일 수 있는지 여부를 확인한다.
            - 인터럽트 플래그(Interrupt flag)
                - 플래그 레지스터에 위치한 플래그로서, 하드웨어 인터럽트 요청을 수용할지 무시할지를 결정하는 플래그
                - 막을 수 있는 인터럽트
                    - 플래그를 ‘불가능’으로 설정하면, CPU는 모든 요청을 무시한다.
                - 막을 수 없는 인터럽트
                    - 플래그가 ‘불가능’이더라도 무시할 수 없고, 가장 먼저 처리해야 하는 최우선순위의 인터럽트이다.
        4. 인터럽트를 받아들일 수 있다면 CPU는 지금까지의 작업을 백업한다.
        5. CPU는 인터럽트 벡터를 참조하여 인터럽트 서비스 루틴을 실행한다.
            - 인터럽트 벡터(Interrupt Vector)
                - 인터럽트 서비스 루틴을 구분하기 위한 정보
                - 인터럽트 벡터에는 인터럽트 서비스 루틴의 주소를 갖고 있어, CPU는 필요에 맞는 특정 인터럽트 서비스 루틴을 찾아가 실행할 수 있다.
            - 인터럽트 서비스 루틴(Interrupt Service Routine)
                - 인터럽트를 처리하기 하기 위한 프로그램으로, 인터럽트 핸들러(interrupt handler)라고도 부른다.
                - ‘어떤 인터럽트가 발생했을 때 어떻게 처리하고 작동해야 할 지’에 대한 정보로 이루어진 프로그램
        6. 인터럽트 서비스 루틴 실행이 끝나면, 백업해 둔 작업을 복구하여 실행을 재개한다.
